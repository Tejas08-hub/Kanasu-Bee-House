<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kanasu Bee House AI</title>

<style>
*{
    box-sizing:border-box;
    margin:0;
    padding:0;
}

body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    background:#f9f9f9;
    height:100vh;
    display:flex;
    flex-direction:column;
}

/* Header */
.header{
    background:#ffcc00;
    padding:15px;
    text-align:center;
    font-weight:bold;
    position:relative;
}

/* Back Button */
.back-btn{
    position:absolute;
    left:15px;
    top:12px;
    text-decoration:none;
    color:#000;
    font-weight:bold;
}

/* Chat Window */
#chat-window{
    flex:1;
    overflow-y:auto;
    padding:15px;
    display:flex;
    flex-direction:column;
    gap:12px;
}

.msg{
    max-width:80%;
    padding:10px 15px;
    border-radius:18px;
    font-size:16px;
    line-height:1.4;
    opacity:0;
    transform:translateY(10px);
    animation:fadeIn 0.25s ease forwards;
}

@keyframes fadeIn{
    to{
        opacity:1;
        transform:translateY(0);
    }
}

.user-msg{
    align-self:flex-end;
    background:#ffcc00;
    color:#000;
    border-bottom-right-radius:2px;
}

.bot-msg{
    align-self:flex-start;
    background:#eeeeee;
    color:#333;
    border-bottom-left-radius:2px;
}

/* Typing dots */
.typing-dots{
    display:inline-flex;
    gap:4px;
}

.typing-dots span{
    width:6px;
    height:6px;
    background:#777;
    border-radius:50%;
    animation:blink 1.4s infinite both;
}

.typing-dots span:nth-child(2){animation-delay:0.2s}
.typing-dots span:nth-child(3){animation-delay:0.4s}

@keyframes blink{
    0%{opacity:.2}
    20%{opacity:1}
    100%{opacity:.2}
}

/* Input */
.input-container{
    padding:10px;
    background:white;
    border-top:1px solid #ddd;
    display:flex;
    gap:8px;
}

#user-input{
    flex:1;
    padding:12px;
    border:1px solid #ccc;
    border-radius:25px;
    font-size:16px;
    outline:none;
}

#send-btn{
    background:#ffcc00;
    border:none;
    padding:10px 20px;
    border-radius:25px;
    font-weight:bold;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="header">
    <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
    Kanasu Bee Chatbot
</div>

<div id="chat-window">
    <div class="msg bot-msg">
        Hi, I'm Kanasu Bee..<br>
        How can I help you today about bee keeping?
    </div>
</div>

<div class="input-container">
    <input type="text" id="user-input" placeholder="Ask about bee keeping..." autocomplete="off">
    <button id="send-btn">Send</button>
</div>

<script>
const chatWindow=document.getElementById('chat-window');
const userInput=document.getElementById('user-input');
const sendBtn=document.getElementById('send-btn');

const SERVER_URL="https://kanasu-api.onrender.com/chat";

async function handleSend(){
    const text=userInput.value.trim();
    if(!text)return;

    addMessage(text,'user-msg');
    userInput.value='';

    const typingDiv=document.createElement('div');
    typingDiv.className='msg bot-msg';
    typingDiv.id='typing';
    typingDiv.innerHTML=`
        <div class="typing-dots">
            <span></span><span></span><span></span>
        </div>
    `;
    chatWindow.appendChild(typingDiv);
    scrollToBottom();

    try{
        const response=await fetch(SERVER_URL,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({message:text})
        });

        const data=await response.json();
        document.getElementById('typing').remove();
        addMessage(data.reply||"I'm sorry, I couldn't process that.",'bot-msg');

    }catch(err){
        document.getElementById('typing').remove();
        addMessage("Error: Could not connect to hive server.",'bot-msg');
    }
}

function addMessage(text,className){
    const div=document.createElement('div');
    div.className=`msg ${className}`;
    div.innerText=text;
    chatWindow.appendChild(div);
    scrollToBottom();
}

function scrollToBottom(){
    chatWindow.scrollTop=chatWindow.scrollHeight;
}

sendBtn.addEventListener('click',handleSend);
userInput.addEventListener('keypress',(e)=>{
    if(e.key==='Enter')handleSend();
});
</script>

</body>
</html>